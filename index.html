<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ferreter√≠a - Buscador de Productos</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f4f4;
      padding: 30px;
      color: #222;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 800px;
      width: 100%;
    }

    h2 {
      background-color: #ffcc00;
      color: #000;
      padding: 10px 20px;
      border-left: 8px solid #333;
      display: inline-block;
      text-align: center;
    }

    input {
      padding: 10px;
      width: 100%;
      margin: 15px 0;
      border: 2px solid #333;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      margin-top: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    th {
      background-color: #333;
      color: white;
      padding: 10px;
      text-align: left;
    }

    td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }

    tr:hover {
      background-color: #fffae6;
    }

    button {
      padding: 6px 10px;
      background-color: #ffcc00;
      border: none;
      font-weight: bold;
      cursor: pointer;
      color: #000;
    }

    button:hover {
      background-color: #e6b800;
    }

    #selected, #ticket {
      margin-top: 20px;
      padding: 10px;
      background-color: #fff;
      border: 2px dashed #999;
    }

    #selected li {
      margin-bottom: 5px;
    }

    #total {
      font-size: 22px;
      margin-top: 20px;
      font-weight: bold;
      color: #333;
    }

    #resetBtn, #printBtn {
      margin-top: 10px;
      margin-right: 10px;
      background-color: #c62828;
      color: white;
    }

    #resetBtn:hover, #printBtn:hover {
      background-color: #a00000;
    }

    .qty-input {
      width: 50px;
      margin-right: 5px;
    }

    /* SOLO imprimir el ticket */
    @media print {
      body * {
        visibility: hidden;
      }

      #ticket, #ticket * {
        visibility: visible;
      }

      #ticket {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>FERRETER√çA - BUSCADOR DE PRODUCTOS</h2>

  <input type="text" id="search" placeholder="Buscar por c√≥digo o nombre (m√≠n. 3 letras) y presionar Enter...">

  <table id="results">
    <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Descripci√≥n</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Agregar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Productos Seleccionados:</h3>
  <ul id="selected"></ul>

  <div id="total">Total: $0,00</div>
  <button id="resetBtn">üßπ Reset</button>
  <button id="printBtn">üñ®Ô∏è Imprimir Ticket</button>

  <div id="ticket" style="display:none; margin-top:30px;">
    <h3>üßæ Ticket de Compra</h3>
    <pre id="ticketContent" style="white-space:pre-wrap; font-family: monospace;"></pre>
  </div>
</div>

<script>
  const productos = [
    { codigo: "2225-00250", descripcion: "TEXTUMEX IMPERMEABLE X 25 L (C/RODILLO) G.ME.", precio: 100328.63 },
    { codigo: "2225-00400", descripcion: "TEXTUMEX IMPERMEABLE X 5 L (C/RODILLO) G.MED", precio: 22954.60 },
    { codigo: "517-PACLIN", descripcion: "THINER STANDARD 900 CC", precio: 5013.55 },
    { codigo: "10DA", descripcion: "TIERNITOS PERRO ADULTO CARNE X 21 K", precio: 34708.70 },
    { codigo: "10DA-U", descripcion: "TIERNITOS PERRO ADULTO CARNE X KILOGRAMO", precio: 1907.07 },
    { codigo: "223DA", descripcion: "TIERNITOS PERRO ADULTO CARNE C/VEGETALES X 21 K", precio: 34708.70 },
    { codigo: "5DA", descripcion: "TIERNITOS PERRO CACHORRO X 21 K", precio: 39322.40 },
    { codigo: "859DA", descripcion: "TIERRA CHICA", precio: 3000.20 },
    { codigo: "1112DA", descripcion: "TIERRA GRANDE", precio: 3630.00 },
    { codigo: "3436", descripcion: "TIJERA (PODAR) 8\"", precio: 19439.07 },
    { codigo: "5888", descripcion: "TIJERA CORTA-CA√ëO PVC PROF.", precio: 29312.70 }
  ];

  const searchInput = document.getElementById("search");
  const resultsBody = document.querySelector("#results tbody");
  const selectedList = document.getElementById("selected");
  const totalDiv = document.getElementById("total");
  const resetBtn = document.getElementById("resetBtn");
  const printBtn = document.getElementById("printBtn");
  const ticketDiv = document.getElementById("ticket");
  const ticketContent = document.getElementById("ticketContent");

  let seleccionados = [];

  function formatearPrecio(precio) {
    return new Intl.NumberFormat('es-AR', {
      style: 'currency',
      currency: 'ARS'
    }).format(precio);
  }

  function renderResults() {
    const term = searchInput.value.toLowerCase().trim();
    resultsBody.innerHTML = "";

    if (term.length < 3) return;

    const resultados = productos.filter(p =>
      p.codigo.toLowerCase().includes(term) ||
      p.descripcion.toLowerCase().startsWith(term)
    );

    resultados.forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.codigo}</td>
        <td>${p.descripcion}</td>
        <td>${formatearPrecio(p.precio)}</td>
        <td><input class="qty-input" type="number" id="qty-${p.codigo}" min="1" value="1"></td>
        <td><button onclick="agregar('${p.codigo}')">+</button></td>
      `;
      resultsBody.appendChild(row);
    });
  }

  function agregar(codigo) {
    const producto = productos.find(p => p.codigo === codigo);
    const qtyInput = document.getElementById(`qty-${codigo}`);
    const cantidad = parseInt(qtyInput.value) || 1;

    if (producto && cantidad > 0) {
      seleccionados.push({ ...producto, cantidad });
      actualizarSeleccion();
    }
  }

  function actualizarSeleccion() {
    selectedList.innerHTML = "";
    let total = 0;
    seleccionados.forEach(p => {
      const item = document.createElement("li");
      const subtotal = p.precio * p.cantidad;
      item.textContent = `${p.descripcion} x${p.cantidad} - ${formatearPrecio(subtotal)}`;
      selectedList.appendChild(item);
      total += subtotal;
    });
    totalDiv.textContent = `Total: ${formatearPrecio(total)}`;
  }

  resetBtn.addEventListener("click", () => {
    seleccionados = [];
    actualizarSeleccion();
    searchInput.value = "";
    resultsBody.innerHTML = "";
    ticketDiv.style.display = "none";
  });

  function activarBusquedaAlPresionarEnter() {
    searchInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        renderResults();
      }
    });

    searchInput.addEventListener("keyup", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        renderResults();
      }
    });
  }

  activarBusquedaAlPresionarEnter();

  printBtn.addEventListener("click", () => {
    if (seleccionados.length === 0) {
      alert("No hay productos seleccionados.");
      return;
    }

    const fechaHora = new Date().toLocaleString('es-AR');
    let ticket = "----------------------------------------\n";
    ticket += "       FERRETER√çA LOS AMIGOS\n";
    ticket += `       ${fechaHora}\n`;
    ticket += "----------------------------------------\n";
    let total = 0;

    seleccionados.forEach(p => {
      const subtotal = p.precio * p.cantidad;
      ticket += `${p.codigo.padEnd(10)} ${p.descripcion.substring(0, 25).padEnd(25)} ${formatearPrecio(subtotal)} (x${p.cantidad})\n`;
      total += subtotal;
    });

    ticket += "----------------------------------------\n";
    ticket += `TOTAL FINAL: ${formatearPrecio(total)}\n`;

    ticketContent.textContent = ticket;
    ticketDiv.style.display = "block";
    window.print();
  });
</script>

</body>
</html>
